# 公司风采图片功能说明

## 📋 功能概述

在"关于我们"页面添加了公司风采轮播图功能，通过复用现有的 `banners` 表，添加 `type` 字段来区分不同类型的图片展示。

---

## 🗄️ 数据库修改

### 1. 执行 SQL 更新

运行 `database_update_banners_type.sql` 文件中的SQL语句：

```bash
mysql -u root -p songjia_textile < database_update_banners_type.sql
```

或者手动执行以下SQL：

```sql
-- 添加 type 字段
ALTER TABLE `banners`
ADD COLUMN `type` enum('home_banner','company_gallery','product_banner')
DEFAULT 'home_banner'
COMMENT '图片类型：home_banner-首页轮播，company_gallery-公司风采，product_banner-商品轮播'
AFTER `id`;

-- 添加索引
ALTER TABLE `banners`
ADD INDEX `idx_type` (`type`);

-- 更新已有数据
UPDATE `banners` SET `type` = 'home_banner' WHERE `type` IS NULL;
```

### 2. 插入公司风采示例数据

```sql
INSERT INTO `banners` (`type`, `title`, `image_url`, `link_url`, `link_type`, `sort_order`, `status`, `created_at`) VALUES
('company_gallery', '现代化生产车间 - 自动化织造设备', 'https://your-cdn.com/company/workshop.jpg', NULL, 'none', 1, 1, NOW()),
('company_gallery', '质量检测中心 - 严格品控流程', 'https://your-cdn.com/company/quality-control.jpg', NULL, 'none', 2, 1, NOW()),
('company_gallery', '产品展示厅 - 千余种面料样品', 'https://your-cdn.com/company/showroom.jpg', NULL, 'none', 3, 1, NOW()),
('company_gallery', '企业办公大楼 - 现代化办公环境', 'https://your-cdn.com/company/office-building.jpg', NULL, 'none', 4, 1, NOW()),
('company_gallery', '仓储物流中心 - 高效配送体系', 'https://your-cdn.com/company/warehouse.jpg', NULL, 'none', 5, 1, NOW());
```

**⚠️ 重要提示**：请将示例中的图片URL替换为你的真实图片URL！

---

## 🔧 后端修改说明

### 已修改的文件：

1. **Banner.java** - 添加 `type` 字段和 `BannerType` 枚举
2. **BannerMapper.java** - 添加 `findByTypeAndStatus()` 方法
3. **BannerMapper.xml** - 添加 SQL 查询和 type 字段映射
4. **BannerService.java** - 添加 `getBannersByType()` 方法
5. **BannerController.java** - 添加 `/banner/type/{type}` API 接口

### API 接口

```
GET /banner/type/company_gallery
```

返回格式：
```json
{
  "code": 200,
  "message": "获取成功",
  "data": [
    {
      "id": 1,
      "type": "company_gallery",
      "title": "现代化生产车间 - 自动化织造设备",
      "imageUrl": "https://your-cdn.com/company/workshop.jpg",
      "linkUrl": null,
      "linkType": "none",
      "sortOrder": 1,
      "status": true
    }
  ]
}
```

---

## 🎨 前端修改说明

### 已修改的文件：

1. **pages/usercenter/index.wxml** - 添加轮播图组件
2. **pages/usercenter/index.js** - 从后端API获取数据
3. **pages/usercenter/index.wxss** - 添加轮播图样式
4. **services/banner/fetchBanner.js** - 新建API服务文件

### 功能特性

- ✅ 自动播放（3秒间隔）
- ✅ 循环播放
- ✅ 绿色主题指示器
- ✅ 底部渐变文字说明
- ✅ 点击图片全屏预览
- ✅ 懒加载优化

---

## 📸 如何添加/管理图片

### 方法1：直接在数据库中添加

```sql
INSERT INTO `banners` (`type`, `title`, `image_url`, `sort_order`, `status`) VALUES
('company_gallery', '图片标题', 'https://图片URL', 排序号, 1);
```

### 方法2：使用后台管理系统（如果有）

1. 进入轮播图管理页面
2. 新增轮播图
3. 选择类型为"公司风采"（company_gallery）
4. 上传图片，填写标题
5. 设置排序和状态
6. 保存

### 图片建议

- **尺寸**：750px × 400px（宽高比 1.875:1）
- **格式**：JPG/PNG
- **大小**：每张不超过500KB
- **内容**：
  - 工厂外观和生产车间
  - 质量检测中心
  - 产品展示厅
  - 办公环境
  - 仓储物流中心
  - 团队合影
  - 荣誉资质

---

## 🎯 banner 表的类型说明

| type 值 | 说明 | 用途 |
|---------|------|------|
| `home_banner` | 首页轮播图 | 小程序首页顶部轮播展示 |
| `company_gallery` | 公司风采图片 | "关于我们"页面轮播展示 |
| `product_banner` | 商品轮播图 | 商品详情页轮播（预留） |

---

## 🧪 测试步骤

### 1. 执行 SQL 更新

```bash
mysql -u root -p songjia_textile < database_update_banners_type.sql
```

### 2. 启动后端服务

```bash
cd miniprogram-3-backend
mvn spring-boot:run
```

### 3. 测试 API

```bash
# 获取公司风采图片
curl http://localhost:8080/banner/type/company_gallery
```

### 4. 启动小程序

打开微信开发者工具，进入"关于我们"页面，应该能看到公司风采轮播图。

---

## 🐛 常见问题

### Q1: 数据库修改后后端启动报错？

**A**: 检查 `Banner` 实体类是否正确添加了 `type` 字段：
```java
private String type;
```

### Q2: 前端显示空白？

**A**:
1. 检查控制台日志，确认API调用成功
2. 确认数据库中有 `type='company_gallery'` 且 `status=1` 的数据
3. 检查图片URL是否有效

### Q3: 首页轮播图也显示公司风采图片？

**A**: 检查首页代码，确保调用的是 `type='home_banner'` 的数据。

---

## 📚 扩展功能建议

### 1. 添加后台管理界面

创建一个管理页面，可以：
- 上传图片到CDN
- CRUD操作轮播图
- 拖拽排序
- 预览效果

### 2. 添加统计功能

```sql
ALTER TABLE `banners` ADD COLUMN `view_count` INT DEFAULT 0 COMMENT '浏览次数';
```

### 3. 视频支持

```sql
ALTER TABLE `banners` ADD COLUMN `media_type` ENUM('image', 'video') DEFAULT 'image';
ALTER TABLE `banners` ADD COLUMN `video_url` VARCHAR(500) NULL COMMENT '视频URL';
```

---

**最后更新**：2025-12-29
**作者**：Claude Code
